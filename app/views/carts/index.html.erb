<table class="table table-bordered">
  <tr>
    <th>Item</th>
    <th>Quantity</th>
    <th>Price</th>
  </tr>

  <% if (!logged_in?) %>
    <% if session[:current_cart].key?("not_logged") %>
      <% session[:current_cart]["not_logged"].each do |item| %>
        <tr>
          <td>
            <%= link_to item[0], item_path(Item.find_by_name(item[0])) %>
          </td>
          <td>
            <%= item[1] %>
          </td>
          <td>
            $ <%= (Item.find_by_name(item[0])).price*item[1] %>
          </td>
        </tr>
      <% end %>
    <% end %>
  <% else %>
  <% if session[:current_cart][current_user.username] %>
      <% session[:current_cart][current_user.username].each do |item| %>
        <tr>
          <td>
            <%= link_to item[0], item_path(Item.find_by_name(item[0])) %>
          </td>
          <td>
            <%= item[1] %>
          </td>
          <td>
            $ <%= (Item.find_by_name(item[0])).price*item[1] %>
          </td>
        </tr>
      <% end %>
  <% end %>
    <tr>
      <td>Total</td>
      <td>
        <%= count_items_and_price[0] %>
      </td>
      <td>
        $ <%= count_items_and_price[1] %>
      </td>
    </tr>
  </table>
<% end %>

<% if logged_in? %>
  <%= form_for :order, url: orders_path do |f| %>
    <%= f.hidden_field :user_id, :value => session[:user_id] %>
    <%= f.hidden_field :quantity, :value => count_items_and_price[0] %>
    <%= f.hidden_field :subtotal, :value => count_items_and_price[1] %>
    <%= f.collection_check_boxes :item_ids, Item.all, :id, :name do |cb| %>
      <% cb.label(class: "checkbox-inline input_checkbox") {cb.check_box(class: "checkbox") + cb.text} %>
    <% end %>

    <%= f.submit "Comprar" %>
  <% end %>
<% end %>
<%= link_to 'Voltar', items_path %>
